"use strict";(()=>{function S(r){for(var e=new Uint8Array(r.length),t=0;t<e.length;t++)e[t]=r[t].charCodeAt(0)&255;return e}var T=class{constructor(r,e=0){this.buffer=r,this.p=e,this.length=r.length}get pointer(){return this.p}set pointer(r){this.p=r}get offset(){return this.p}set offset(r){this.p=r}readByte(){return this.buffer[this.p++]}writeByte(r){this.buffer[this.p++]=r}readShort(){return this.buffer[this.p++]|this.buffer[this.p++]<<8}writeShort(r){this.buffer[this.p++]=r&255,this.buffer[this.p++]=r>>>8&255}readUint(){return(this.buffer[this.p++]|this.buffer[this.p++]<<8|this.buffer[this.p++]<<16|this.buffer[this.p++]<<24)>>>0}writeUint(r){this.buffer[this.p++]=r&255,this.buffer[this.p++]=r>>>8&255,this.buffer[this.p++]=r>>>16&255,this.buffer[this.p++]=r>>>24&255}readUintBE(){return(this.buffer[this.p++]<<24|this.buffer[this.p++]<<16|this.buffer[this.p++]<<8|this.buffer[this.p++])>>>0}writeUintBE(r){this.buffer[this.p++]=r>>>24&255,this.buffer[this.p++]=r>>>16&255,this.buffer[this.p++]=r>>>8&255,this.buffer[this.p++]=r&255}readArray(r){return this.buffer.subarray(this.p,this.p+=r)}writeArray(r){this.buffer.set(r,this.p),this.p+=r.length}readString(r){return new TextDecoder().decode(this.readArray(r))}writeString(r){this.writeArray(new TextEncoder().encode(r))}readAscii(r){var e="",t=this.readArray(r);return t.forEach(s=>{e+=String.fromCharCode(s)}),e}writeAscii(r){this.writeArray(S(r))}},U={create(r,e,t){return this.update(r,0,e,t)},update(r,e,t=0,s){var i=U.Table,a=s??r.length;e^=4294967295;for(var h=a&7;h--;++t)e=e>>>8^i[(e^r[t])&255];for(var h=a>>3;h--;t+=8)e=e>>>8^i[(e^r[t])&255],e=e>>>8^i[(e^r[t+1])&255],e=e>>>8^i[(e^r[t+2])&255],e=e>>>8^i[(e^r[t+3])&255],e=e>>>8^i[(e^r[t+4])&255],e=e>>>8^i[(e^r[t+5])&255],e=e>>>8^i[(e^r[t+6])&255],e=e>>>8^i[(e^r[t+7])&255];return(e^4294967295)>>>0},single(r,e){return U.Table[(r^e)&255]^r>>>8},Table:new Uint32Array(256),init(){for(var r=0;r<256;++r){for(var e=r,t=0;t<8;++t)e=e&1?3988292384^e>>>1:e>>>1;this.Table[r]=e>>>0}}};U.init();var _=32768,N=32768,j=32768,g=32768,z=class m{constructor(e,t=0){if(this.bitindex=0,this.buffer=e instanceof Uint8Array?e:new Uint8Array(j),this.index=t,this.buffer.length*2<=this.index)throw new Error("invalid index");this.buffer.length<=this.index&&this.expandBuffer()}expandBuffer(){var e=this.buffer,t=new Uint8Array(e.length<<1);return t.set(e),this.buffer=t,t}rev32(e){return m.ReverseTable[e&255]<<24|m.ReverseTable[e>>>8&255]<<16|m.ReverseTable[e>>>16&255]<<8|m.ReverseTable[e>>>24&255]}writeBits(e,t,s=!1){var i=this.buffer,a=this.index,h=this.bitindex,f=i[a],n;if(s&&t>1&&(e=t>8?this.rev32(e)>>32-t:m.ReverseTable[e]>>8-t),t+h<8)f=f<<t|e,h+=t;else for(n=0;n<t;++n)f=f<<1|e>>t-n-1&1,++h===8&&(h=0,i[a++]=m.ReverseTable[f],f=0,a===i.length&&(i=this.expandBuffer()));i[a]=f,this.buffer=i,this.bitindex=h,this.index=a}finish(){var e=this.buffer,t=this.index,s;return this.bitindex>0&&(e[t]<<=8-this.bitindex,e[t]=m.ReverseTable[e[t]],t++),s=e.subarray(0,t),s}static init(){this.ReverseTable=new Uint8Array(256).map((e,t)=>{var s=t,i=7;for(t>>>=1;t;t>>>=1)s<<=1,s|=t&1,--i;return s<<i&255})}};z.init();var ee=class{constructor(r){this.buffer=new Uint16Array(r*2),this.length=0}getParent(r){return r-2>>2<<1}getChild(r){return 2*r+2}push(r,e){var t,s,i=this.buffer,a;for(t=this.length,i[this.length++]=e,i[this.length++]=r;t>0&&(s=this.getParent(t),i[t]>i[s]);)a=i[t],i[t]=i[s],i[s]=a,a=i[t+1],i[t+1]=i[s+1],i[s+1]=a,t=s;return this.length}pop(){var r,e,t=this.buffer,s,i,a;for(e=t[0],r=t[1],this.length-=2,t[0]=t[this.length],t[1]=t[this.length+1],a=0;i=this.getChild(a),!(i>=this.length);){if(i+2<this.length&&t[i+2]>t[i]&&(i+=2),t[i]>t[a])s=t[a],t[a]=t[i],t[i]=s,s=t[a+1],t[a+1]=t[i+1],t[i+1]=s;else break;a=i}return{index:r,value:e,length:this.length}}};function C(r){var e=r.length,t,s,i,a,h,f,n=0,u=Number.POSITIVE_INFINITY;for(a=0;a<e;++a)r[a]>n&&(n=r[a]),r[a]<u&&(u=r[a]);var l=1<<n,v=new Uint32Array(l);for(t=1,s=0,i=2;t<=n;){for(a=0;a<e;++a)if(r[a]===t){var o=0,b=s;for(h=0;h<t;++h)o=o<<1|b&1,b>>=1;for(f=t<<16|a,h=o;h<l;h+=i)v[h]=f;++s}++t,s<<=1,i<<=1}return[v,n,u]}var R=258,I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),P=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),W=function(){var r=new Uint8Array(288).map((e,t)=>t<=143?8:t<=255?9:t<=279?7:8);return C(r)}(),K=function(){var r=new Uint8Array(30).map(e=>5);return C(r)}(),re=class{constructor(r,e={}){this.buffer=null,this.block=[],this.blocks=[],this.bufferSize=N,this.totalpos=0,this.ip=0,this.op=0,this.bitsbuf=0,this.bitsbuflen=0,this.bfinal=!1,this.bufferType=1,this.resize=!1,this.currentLitlenTable=null,this.input=r instanceof Uint8Array?r:new Uint8Array(r),this.ip=e.index??0,this.bufferSize=e.bufferSize??N,this.bufferType=e.bufferType??1,this.resize=e.resize??!1,this.bufferType==0?(this.op=g,this.output=new Uint8Array(g+this.bufferSize+R)):(this.op=0,this.output=new Uint8Array(this.bufferSize))}decompress(){for(;!this.bfinal;)this.parseBlock();switch(this.bufferType){case 0:return this.concatBufferBlock();case 1:return this.concatBufferDynamic();default:throw new Error("invalid inflate mode")}}parseBlock(){var r=this.readBits(3);switch(r&1&&(this.bfinal=!0),r>>>=1,r){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+r)}}readBits(r){var e=this.bitsbuf,t=this.bitsbuflen,s=this.input,i=this.ip,a=s.length,h;if(i+(r-t+7>>3)>=a)throw new Error("input buffer is broken");for(;t<r;)e|=s[i++]<<t,t+=8;return h=e&(1<<r)-1,e>>>=r,t-=r,this.bitsbuf=e,this.bitsbuflen=t,this.ip=i,h}readCodeByTable(r){for(var e=this.bitsbuf,t=this.bitsbuflen,s=this.input,i=this.ip,a=s.length,h=r[0],f=r[1];t<f&&!(i>=a);)e|=s[i++]<<t,t+=8;var n=h[e&(1<<f)-1],u=n>>>16;if(u>t)throw new Error("invalid code length: "+u);return this.bitsbuf=e>>u,this.bitsbuflen=t-u,this.ip=i,n&65535}parseUncompressedBlock(){var r=this.input,e=this.ip,t=this.output,s=this.op,i=r.length,a=t.length;if(this.bitsbuf=0,this.bitsbuflen=0,e+1>=i)throw new Error("invalid uncompressed block header: LEN");var h=r[e++]|r[e++]<<8;if(e+1>=i)throw new Error("invalid uncompressed block header: NLEN");var f=r[e++]|r[e++]<<8;if(h===~f)throw new Error("invalid uncompressed block header: length verify");if(e+h>r.length)throw new Error("input buffer is broken");switch(this.bufferType){case 0:for(;s+h>t.length;){var n=a-s;h-=n,t.set(r.subarray(e,e+n),s),s+=n,e+=n,this.op=s,t=this.expandBufferBlock(),s=this.op}break;case 1:for(;s+h>t.length;)t=this.expandBufferAdaptive(0,2);break;default:throw new Error("invalid inflate mode")}t.set(r.subarray(e,e+h),s),s+=h,e+=h,this.ip=e,this.op=s,this.output=t}parseFixedHuffmanBlock(){switch(this.bufferType){case 1:this.decodeHuffmanAdaptive(W,K);break;case 0:this.decodeHuffmanBlock(W,K);break;default:throw new Error("invalid inflate mode")}}parseDynamicHuffmanBlock(){for(var r=this.readBits(5)+257,e=this.readBits(5)+1,t=this.readBits(4)+4,s=new Uint8Array(I.length),i=0;i<t;++i)s[I[i]]=this.readBits(3);for(var a=C(s),h=new Uint8Array(r+e),f=0,i=0;i<r+e;){var n=this.readCodeByTable(a);switch(n){case 16:for(var u=3+this.readBits(2);u--;)h[i++]=f;break;case 17:for(var u=3+this.readBits(3);u--;)h[i++]=0;f=0;break;case 18:for(var u=11+this.readBits(7);u--;)h[i++]=0;f=0;break;default:h[i++]=n,f=n;break}}var l=C(h.subarray(0,r)),v=C(h.subarray(r));switch(this.bufferType){case 1:this.decodeHuffmanAdaptive(l,v);break;case 0:this.decodeHuffmanBlock(l,v);break;default:throw new Error("invalid inflate mode")}}decodeHuffmanBlock(r,e){var t=this.output,s=this.op;this.currentLitlenTable=r;for(var i=t.length-R,a;(a=this.readCodeByTable(r))!==256;){if(a<256){s>=i&&(this.op=s,t=this.expandBufferBlock(),s=this.op),t[s++]=a;continue}var h=a-257,f=P[h];M[h]>0&&(f+=this.readBits(M[h])),a=this.readCodeByTable(e);var n=q[a];for(O[a]>0&&(n+=this.readBits(O[a])),s>=i&&(this.op=s,t=this.expandBufferBlock(),s=this.op);f--;)t[s]=t[s++-n]}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=s}decodeHuffmanAdaptive(r,e){var t=this.output,s=this.op;this.currentLitlenTable=r;for(var i=t.length,a;(a=this.readCodeByTable(r))!==256;){if(a<256){s>=i&&(t=this.expandBufferAdaptive(),i=t.length),t[s++]=a;continue}var h=a-257,f=P[h];M[h]>0&&(f+=this.readBits(M[h])),a=this.readCodeByTable(e);var n=q[a];for(O[a]>0&&(n+=this.readBits(O[a])),s+f>i&&(t=this.expandBufferAdaptive(),i=t.length);f--;)t[s]=t[s++-n]}for(;this.bitsbuflen>=8;)this.bitsbuflen-=8,this.ip--;this.op=s}expandBufferBlock(){var r=new Uint8Array(this.op-g),e=this.op-g,t=this.output;return r.set(t.subarray(g,r.length)),this.blocks.push(r),this.totalpos+=r.length,t.set(t.subarray(e,e+g)),this.op=g,t}expandBufferAdaptive(r=0,e){var t=Math.floor(this.input.length/this.ip+1),s,i=this.input,a=this.output;if(t=(e??t)+r,t<2){var h=(i.length-this.ip)/this.currentLitlenTable[2],f=Math.floor(h/2*258);s=f<a.length?a.length+f:a.length<<1}else s=a.length*t;var n=new Uint8Array(s);return n.set(a),this.output=n,this.output}concatBufferBlock(){var r=0,e=this.totalpos+(this.op-g),t=this.output,s=this.blocks,i=new Uint8Array(e),a,h;if(s.length===0)return this.output.subarray(g,this.op);for(var f=0;f<s.length;++f){var n=s[f];i.set(n,r),r+=n.length}for(var f=g;f<this.op;++f)i[r++]=t[f];return this.blocks=[],this.buffer=i,this.buffer}concatBufferDynamic(){var r=this.op,e;return this.resize?(e=new Uint8Array(r),e.set(this.output.subarray(0,r))):e=this.output.subarray(0,r),this.buffer=e,this.buffer}},D=3,Y=258,te=32768,ae=16,ie=286,se=function(){var r=[],e;for(e=0;e<288;e++)switch(!0){case e<=143:r.push([e+48,8]);break;case e<=255:r.push([e-144+400,9]);break;case e<=279:r.push([e-256+0,7]);break;case e<=287:r.push([e-280+192,8]);break;default:throw"invalid literal: "+e}return r}(),ne=class ${constructor(e,t){this.length=e,this.backwardDistance=t}static{this.LengthCodeTable=function(){var e=[],t,s;for(t=3;t<=258;t++)s=i(t),e[t]=s[2]<<24|s[1]<<16|s[0];function i(a){switch(!0){case a===3:return[257,a-3,0];case a===4:return[258,a-4,0];case a===5:return[259,a-5,0];case a===6:return[260,a-6,0];case a===7:return[261,a-7,0];case a===8:return[262,a-8,0];case a===9:return[263,a-9,0];case a===10:return[264,a-10,0];case a<=12:return[265,a-11,1];case a<=14:return[266,a-13,1];case a<=16:return[267,a-15,1];case a<=18:return[268,a-17,1];case a<=22:return[269,a-19,2];case a<=26:return[270,a-23,2];case a<=30:return[271,a-27,2];case a<=34:return[272,a-31,2];case a<=42:return[273,a-35,3];case a<=50:return[274,a-43,3];case a<=58:return[275,a-51,3];case a<=66:return[276,a-59,3];case a<=82:return[277,a-67,4];case a<=98:return[278,a-83,4];case a<=114:return[279,a-99,4];case a<=130:return[280,a-115,4];case a<=162:return[281,a-131,5];case a<=194:return[282,a-163,5];case a<=226:return[283,a-195,5];case a<=257:return[284,a-227,5];case a===258:return[285,a-258,0];default:throw"invalid length: "+a}}return new Uint32Array(e)}()}getDistanceCode(e){var t;switch(!0){case e===1:t=[0,e-1,0];break;case e===2:t=[1,e-2,0];break;case e===3:t=[2,e-3,0];break;case e===4:t=[3,e-4,0];break;case e<=6:t=[4,e-5,1];break;case e<=8:t=[5,e-7,1];break;case e<=12:t=[6,e-9,2];break;case e<=16:t=[7,e-13,2];break;case e<=24:t=[8,e-17,3];break;case e<=32:t=[9,e-25,3];break;case e<=48:t=[10,e-33,4];break;case e<=64:t=[11,e-49,4];break;case e<=96:t=[12,e-65,5];break;case e<=128:t=[13,e-97,5];break;case e<=192:t=[14,e-129,6];break;case e<=256:t=[15,e-193,6];break;case e<=384:t=[16,e-257,7];break;case e<=512:t=[17,e-385,7];break;case e<=768:t=[18,e-513,8];break;case e<=1024:t=[19,e-769,8];break;case e<=1536:t=[20,e-1025,9];break;case e<=2048:t=[21,e-1537,9];break;case e<=3072:t=[22,e-2049,10];break;case e<=4096:t=[23,e-3073,10];break;case e<=6144:t=[24,e-4097,11];break;case e<=8192:t=[25,e-6145,11];break;case e<=12288:t=[26,e-8193,12];break;case e<=16384:t=[27,e-12289,12];break;case e<=24576:t=[28,e-16385,13];break;case e<=32768:t=[29,e-24577,13];break;default:throw"invalid distance"}return t}toLZ77Array(){var e=$.LengthCodeTable[this.length],t=this.getDistanceCode(this.backwardDistance);return[e&65535,e>>>16&255,e>>>24,t[0],t[1],t[2]]}},he=class{constructor(r,e={}){this.freqsLitLen=null,this.freqsDist=null,this.op=0,this.input=r instanceof Uint8Array?r:new Uint8Array(r),this.lazy=e.lazy??0,this.compressionType=e.compressionType??2,e.outputBuffer?this.output=e.outputBuffer instanceof Uint8Array?e.outputBuffer:new Uint8Array(e.outputBuffer):this.output=new Uint8Array(_),this.op=e.outputIndex??0}compress(){var r=this.input,e=r.length;switch(this.compressionType){case 0:for(var t=0,e=r.length;t<e;){var s=r.subarray(t,t+65535);t+=s.length,this.makeNocompressBlock(s,t===e)}break;case 1:this.output=this.makeFixedHuffmanBlock(r,!0),this.op=this.output.length;break;case 2:this.output=this.makeDynamicHuffmanBlock(r,!0),this.op=this.output.length;break;default:throw"invalid compression type"}return this.output}makeNocompressBlock(r,e){var t=this.output,s=this.op;for(t=new Uint8Array(this.output.buffer);t.length<=s+r.length+5;)t=new Uint8Array(t.length<<1);t.set(this.output);var i=0;t[s++]=(e?1:0)|i<<1;var a=r.length,h=~a+65536&65535;return t[s++]=a&255,t[s++]=a>>>8&255,t[s++]=h&255,t[s++]=h>>>8&255,t.set(r,s),s+=r.length,t=t.subarray(0,s),this.op=s,this.output=t,t}makeFixedHuffmanBlock(r,e){var t=new z(new Uint8Array(this.output.buffer),this.op);t.writeBits(e?1:0,1,!0),t.writeBits(1,2,!0);var s=this.LZ77(r);return this.fixedHuffman(s,t),t.finish()}makeDynamicHuffmanBlock(r,e){var t=new z(new Uint8Array(this.output.buffer),this.op);t.writeBits(e?1:0,1,!0),t.writeBits(2,2,!0);var s=this.LZ77(r),i=this.getLengths(this.freqsLitLen,15),a=this.getCodesFromLengths(i),h=this.getLengths(this.freqsDist,7),f=this.getCodesFromLengths(h),n,u;for(n=286;n>257&&i[n-1]===0;n--);for(u=30;u>1&&h[u-1]===0;u--);var l=this.getTreeSymbols(n,i,u,h),v=this.getLengths(l.freqs,7),o=new Array(19);for(w=0;w<19;w++)o[w]=v[I[w]];for(var b=19;b>4&&o[b-1]===0;b--);var p=this.getCodesFromLengths(v);for(t.writeBits(n-257,5,!0),t.writeBits(u-1,5,!0),t.writeBits(b-4,4,!0),w=0;w<b;w++)t.writeBits(o[w],3,!0);for(var w=0;w<l.codes.length;w++){var c=l.codes[w],d;if(t.writeBits(p[c],v[c],!0),c>=16){switch(w++,c){case 16:d=2;break;case 17:d=3;break;case 18:d=7;break;default:throw"invalid code: "+c}t.writeBits(l.codes[w],d,!0)}}return this.dynamicHuffman(s,[a,i],[f,h],t),t.finish()}dynamicHuffman(r,e,t,s){for(var i=e[0],a=e[1],h=t[0],f=t[1],n=0;n<r.length;++n){var u=r[n],l;if(s.writeBits(i[u],a[u],!0),u>256)s.writeBits(r[++n],r[++n],!0),l=r[++n],s.writeBits(h[l],f[l],!0),s.writeBits(r[++n],r[++n],!0);else if(u===256)break}return s}fixedHuffman(r,e){for(var t=0;t<r.length;t++){var s=r[t];if(z.prototype.writeBits.apply(e,se[s]),s>256)e.writeBits(r[++t],r[++t],!0),e.writeBits(r[++t],5),e.writeBits(r[++t],r[++t],!0);else if(s===256)break}return e}LZ77(r){var e={},t=null,s=new Uint16Array(r.length*2),i=0,a=0,h=new Uint32Array(30),f=this.lazy,n,u=new Uint32Array(286);u[256]=1;function l(B,H){for(var A=B.toLZ77Array(),x=0;x<A.length;++x)s[i++]=A[x];u[A[0]]++,h[A[3]]++,a=B.length+H-1,t=null}var v,o=r.length;for(v=0;v<o;++v){for(var b=0,p=0;p<D&&v+p!==o;++p)b=b<<8|r[v+p];e[b]===void 0&&(e[b]=[]);var w=e[b];if(a-- >0){w.push(v);continue}for(;w.length>0&&v-w[0]>te;)w.shift();if(v+D>=o){t&&l(t,-1);for(var p=0,c=o-v;p<c;++p)n=r[v+p],s[i++]=n,++u[n];break}if(w.length>0){var d=this.searchLongestMatch(r,v,w);t?t.length<d.length?(n=r[v-1],s[i++]=n,++u[n],l(d,0)):l(t,-1):d.length<f?t=d:l(d,0)}else t?l(t,-1):(n=r[v],s[i++]=n,++u[n]);w.push(v)}return s[i++]=256,u[256]++,this.freqsLitLen=u,this.freqsDist=h,s.subarray(0,i)}searchLongestMatch(r,e,t){var s,i=0,a=r.length;e:for(var h=0;h<t.length;h++){var f=t[t.length-h-1],n=D;if(i>D){for(var u=i;u>D;u--)if(r[f+u-1]!==r[e+u-1])continue e;n=i}for(;n<Y&&e+n<a&&r[f+n]===r[e+n];)++n;if(n>i&&(s=f,i=n),n===Y)break}return new ne(i,e-s)}getTreeSymbols(r,e,t,s){var i=new Uint32Array(r+t),a,h,f=r+t,n=new Uint32Array(316),u=new Uint8Array(19);for(h=0,a=0;a<r;a++)i[h++]=e[a];for(a=0;a<t;a++)i[h++]=s[a];var l=0;for(a=0,f=i.length;a<f;a+=h){for(h=1;a+h<f&&i[a+h]===i[a];++h);var v=h;if(i[a]===0)if(v<3)for(;v-- >0;)n[l++]=0,u[0]++;else for(;v>0;){var o=v<138?v:138;o>v-3&&o<v&&(o=v-3),o<=10?(n[l++]=17,n[l++]=o-3,u[17]++):(n[l++]=18,n[l++]=o-11,u[18]++),v-=o}else if(n[l++]=i[a],u[i[a]]++,v--,v<3)for(;v-- >0;)n[l++]=i[a],u[i[a]]++;else for(;v>0;){var o=v<6?v:6;o>v-3&&o<v&&(o=v-3),n[l++]=16,n[l++]=o-3,u[16]++,v-=o}}return{codes:n.subarray(0,l),freqs:u}}getLengths(r,e){for(var t=r.length,s=new ee(2*ie),i=new Uint8Array(t),a=0;a<t;++a)r[a]>0&&s.push(a,r[a]);var h=new Array(s.length/2),f=new Uint32Array(s.length/2);if(h.length===1)return i[s.pop().index]=1,i;for(var n=s.length/2,a=0;a<n;++a)h[a]=s.pop(),f[a]=h[a].value;var u=this.reversePackageMerge(f,f.length,e);for(a=0;a<h.length;++a)i[h[a].index]=u[a];return i}reversePackageMerge(r,e,t){var s=new Uint16Array(t),i=new Uint8Array(t),a=new Uint8Array(e),h=new Array(t),f=new Array(t),n=new Array(t);function u(d){var B=f[d][n[d]];B===e?(u(d+1),u(d+1)):--a[B],++n[d]}s[t-1]=e;for(var l=(1<<t)-e,v=1<<t-1,o=0;o<t;++o)l<v?i[o]=0:(i[o]=1,l-=v),l<<=1,s[t-2-o]=(s[t-1-o]/2|0)+e;s[0]=i[0],h[0]=new Array(s[0]),f[0]=new Array(s[0]);for(var o=1;o<t;++o)s[o]>2*s[o-1]+i[o]&&(s[o]=2*s[o-1]+i[o]),h[o]=new Array(s[o]),f[o]=new Array(s[o]);for(var b=0;b<e;++b)a[b]=t;for(var p=0;p<s[t-1];++p)h[t-1][p]=r[p],f[t-1][p]=p;for(var b=0;b<t;++b)n[b]=0;i[t-1]===1&&(--a[0],++n[t-1]);for(var o=t-2;o>=0;--o){for(var b=0,w=0,c=n[o+1],p=0;p<s[o];p++)w=h[o+1][c]+h[o+1][c+1],w>r[b]?(h[o][p]=w,f[o][p]=e,c+=2):(h[o][p]=r[b],f[o][p]=b,++b);n[o]=0,i[o]===1&&u(o)}return a}getCodesFromLengths(r){for(var e=new Uint16Array(r.length),t=[],s=[],i=0,a,h,f,n=0;n<r.length;n++)t[r[n]]=(t[r[n]]|0)+1;for(var n=1;n<=ae;n++)s[n]=i,i+=t[n]|0,i<<=1;for(var n=0;n<r.length;n++)for(i=s[r[n]],s[r[n]]+=1,e[n]=0,h=0,f=r[n];h<f;h++)e[n]=e[n]<<1|i&1,i>>>=1;return e}},L={getByte(r){var e=r[2]&65535|2;return e*(e^1)>>8&255},updateKeys(r,e){r[0]=U.single(r[0],e),r[1]=r[1]+(r[0]&255),r[1]=Number(BigInt(r[1])*BigInt(134775813)+BigInt(1)&BigInt(4294967295)),r[2]=U.single(r[2],r[1]>>>24)},createKey(r){typeof r=="string"&&(r=S(r));for(var e=new Uint32Array([305419896,591751049,878082192]),t=0;t<r.length;++t)this.updateKeys(e,r[t]&255);return e},decode(r,e){return e^=this.getByte(r),this.updateKeys(r,e),e},encode(r,e){var t=this.getByte(r);return this.updateKeys(r,e),t^e}},E=new Uint8Array([80,75,1,2]),F=new Uint8Array([80,75,3,4]),k=new Uint8Array([80,75,5,6]),fe=class{constructor(r=[]){this.files=[],this.password=null,this.comment=r instanceof Uint8Array?r:new Uint8Array(r)}addFile(r,e="",t={}){var s=r.length;r=r instanceof Uint8Array?r:new Uint8Array(r);var i=t.compressionMethod??8,a=0,h=!1;t.compress!=!1&&i==8&&(a=U.create(r),r=this.deflateWithOption(r,t),h=!0),this.files.push({filename:e,buffer:r,compressionMethod:i,option:t,compressed:h,encrypted:!1,size:s,crc32:a})}setPassword(r){this.password=r}compress(){for(var r=this.files,e=0,t=0,s=0;s<r.length;++s){var i=r[s],a=i.filename.length,h=i.option.extraField?i.option.extraField.length:0,f=i.option.comment?i.option.comment.length:0,n=i.option.date??new Date;if(i.option.mtime=new Uint8Array([(n.getMinutes()&7)<<5|n.getSeconds()>>>1,n.getHours()<<3|n.getMinutes()>>3,(n.getMonth()+1&7)<<5|n.getDate(),(n.getFullYear()-1980&127)<<1|n.getMonth()+1>>3]),i.compressed||(i.crc32=U.create(i.buffer),i.compressionMethod==8&&(i.buffer=this.deflateWithOption(i.buffer,i.option),i.compressed=!0)),i.option.password!=null||this.password!=null){var u=L.createKey(i.option.password??this.password),l=i.buffer,v=new Uint8Array(l.length+12);v.set(l,12),l=v;for(var o=0;o<12;++o)l[o]=L.decode(u,o===11?i.crc32&255:Math.floor(Math.random()*256));for(;o<l.length;++o)l[o]=L.encode(u,l[o]);i.buffer=l}e+=30+a+i.buffer.length,t+=46+a+f}var b=22+(this.comment?this.comment.length:0),p=new Uint8Array(e+t+b),w=new T(p,0),c=new T(p,e);for(s=0;s<r.length;++s){var i=r[s],a=i.filename.length,h=0,f=i.option.comment?i.option.comment.length:0,d=w.p;w.writeArray(F),c.writeArray(E);var B=20;c.writeByte(B&255),c.writeByte(i.option.os??0),w.writeShort(B),c.writeShort(B);var H=0;(i.option.password!=null||this.password!=null)&&(H|=1),w.writeShort(H),c.writeShort(H);var A=i.compressionMethod;w.writeShort(A),c.writeShort(A),w.writeArray(i.option.mtime),c.writeArray(i.option.mtime);var x=i.crc32;w.writeUint(x),c.writeUint(x);var V=i.buffer.length;w.writeUint(V),c.writeUint(V);var X=i.size;w.writeUint(X),c.writeUint(X),w.writeShort(a),c.writeShort(a),w.writeShort(h),c.writeShort(h),c.writeShort(f),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeByte(0),c.writeUint(d);var G=i.filename;if(G){var J=S(G);w.writeArray(J),c.writeArray(J)}var Z=i.option.extraField;Z&&(w.writeArray(Z),c.writeArray(Z));var Q=i.option.comment;if(Q){var pe=S(Q);c.writeArray(pe)}w.writeArray(i.buffer)}var y=new T(p,e+t);return y.writeArray(k),y.writeByte(0),y.writeByte(0),y.writeByte(0),y.writeByte(0),y.writeShort(r.length),y.writeShort(r.length),y.writeUint(t),y.writeUint(e),f=this.comment?this.comment.length:0,y.writeShort(f),this.comment&&y.writeArray(this.comment),p}deflateWithOption(r,e){var t=new he(r,e.deflateOptions);return t.compress()}};function oe(r){var e={};if(e.offset=r.p,r.readByte()!=F[0]||r.readByte()!=F[1]||r.readByte()!=F[2]||r.readByte()!=F[3])throw new Error("invalid local file header signature");return e.needVersion=r.readShort(),e.flags=r.readShort(),e.compression=r.readShort(),e.time=r.readShort(),e.date=r.readShort(),e.crc32=r.readUint(),e.compressedSize=r.readUint(),e.plainSize=r.readUint(),e.fileNameLength=r.readShort(),e.extraFieldLength=r.readShort(),e.filename=r.readString(e.fileNameLength),e.extraField=r.readArray(e.extraFieldLength),e.length=r.p-e.offset,e}function ue(r){var e={};if(e.offset=r.p,r.readByte()!=E[0]||r.readByte()!=E[1]||r.readByte()!=E[2]||r.readByte()!=E[3])throw new Error("invalid file header signature");return e.version=r.readByte(),e.os=r.readByte(),e.needVersion=r.readShort(),e.flags=r.readShort(),e.compression=r.readShort(),e.time=r.readShort(),e.date=r.readShort(),e.crc32=r.readUint(),e.compressedSize=r.readUint(),e.plainSize=r.readUint(),e.fileNameLength=r.readShort(),e.extraFieldLength=r.readShort(),e.fileCommentLength=r.readShort(),e.diskNumberStart=r.readShort(),e.internalFileAttributes=r.readShort(),e.externalFileAttributes=r.readUint(),e.relativeOffset=r.readUint(),e.filename=r.readString(e.fileNameLength),e.extraField=r.readArray(e.extraFieldLength),e.comment=r.readArray(e.fileCommentLength),e.length=r.p-e.offset,e}function ve(r){for(var e=r.length-12;e>0;--e)if(r[e]===k[0]&&r[e+1]===k[1]&&r[e+2]===k[2]&&r[e+3]===k[3])return e;throw new Error("End of Central Directory Record not found")}function le(r){var e={};const t=ve(r),s=new T(r,t);if(s.readByte()!==k[0]||s.readByte()!==k[1]||s.readByte()!==k[2]||s.readByte()!==k[3])throw new Error("invalid signature");return e.numberOfThisDisk=s.readShort(),e.startDisk=s.readShort(),e.totalEntriesThisDisk=s.readShort(),e.totalEntries=s.readShort(),e.centralDirectorySize=s.readUint(),e.centralDirectoryOffset=s.readUint(),e.commentLength=s.readShort(),e.comment=s.readArray(e.commentLength),e}var we=class{constructor(r,e={}){this.ip=0,this.EOCD=null,this.input=r instanceof Uint8Array?r:new Uint8Array(r),this.verify=e.verify??!1,e.password&&(this.password=typeof e.password=="string"?S(e.password):e.password instanceof Uint8Array?e.password:new Uint8Array(e.password))}parseFileHeader(){var r=[],e={};if(!this.fileHeaderList){for(var t=le(this.input),s=new T(this.input,t.centralDirectoryOffset),i=0;i<t.totalEntries;++i){var a=ue(s);r[i]=a,e[a.filename]=i}if(t.centralDirectorySize<s.p-t.centralDirectoryOffset)throw new Error("invalid file header size");this.EOCD=t,this.fileHeaderList=r,this.filenameToIndex=e}}getFileData(r,e={}){var t=this.input,s=this.fileHeaderList,i;if(s||this.parseFileHeader(),s[r]==null)throw new Error("wrong index");var a=s[r].relativeOffset,h=new T(this.input,a),f=oe(h);a+=f.length;var n=f.compressedSize;if(f.flags&1){var u=e.password??this.password;if(!u)throw new Error("encrypted: please set password");for(var l=L.createKey(u),v=a;v<a+12;++v)L.encode(l,t[v]);console.log(f.crc32),a+=12,n-=12;for(var v=a;v<a+n;++v)t[v]=L.decode(l,t[v])}if(f.compression==8?i=new re(this.input,{index:a,bufferSize:f.plainSize}).decompress():i=this.input.subarray(a,a+n),this.verify){var o=U.create(i);if(f.crc32!==o)throw new Error("Incorrect crc: file=0x"+f.crc32.toString(16)+", data=0x"+o.toString(16))}return i}getFilenames(){var r=[];this.fileHeaderList||this.parseFileHeader();for(var e=this.fileHeaderList,t=0;t<e.length;++t)r[t]=e[t].filename;return r}decompress(r,e={}){this.filenameToIndex||this.parseFileHeader();var t=this.filenameToIndex[r];if(t==null)throw new Error(r+" not found");return this.getFileData(t,e)}setPassword(r){typeof r=="string"?this.password=S(r):this.password=r instanceof Uint8Array?r:new Uint8Array(r)}},ce={Zip:fe,Unzip:we};window.Zlib=ce})();
